<html><head><meta http-equiv="Content-Type" content="text/html; charset=Utf-8"><!--<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>--> <link rel="stylesheet" href="./js/thirdPart/bootstrap/css/bootstrap.css"/> <script type="text/javascript" src="xlsx.core.min.js""></script> <script src="./js/thirdPart/jquery/jquery.min.js"></script>  <script src="./datajs/data.js"></script> <script src="./js/thirdPart/bootstrap/js/bootstrap.min.js"></script> <script src="./js/dll.bundle.js"></script> <link href="./css/style.css?33f345029b4f1447cbd9" rel="stylesheet"></head> <script type="text/javascript" src="jquery-1.11.2.min.js"></script><!-- <script type="text/javascript" src="insertDate.js""></script>  --><link rel="stylesheet" type="text/css"  href="insertDate.css"></script><title>数据添加页面</title></head><body><div class="big"><div class="login">    <div class="login-title">信息维护<span><a href="javascript:void(0);" class="close-login">关闭</a></span></div>    <div class="login-input-content">        <div id="one" class="login-input">            <label>&nbsp;&nbsp;节点名称&nbsp;:</label>			<input type="hidden"   id="addOrUpdate"  class="list-input"/>            <input type="text" placeholder="请输入节点名,批量添加用|分隔，批量空节点只填写节点数量即可"  name="name" id="name" class="list-input"/>        </div>      <!--  <div class="login-input">            <label>&nbsp;&nbsp;节点id&nbsp;:</label>           <!--  <select id="jdSelectType" style="float:left;line-height:35px;height:35px;width:350px;border:#ebebeb 1px solid;text-indent:5px;">               <option >知识</option>               <option>条件</option>              </select>  		  <input type="text" placeholder="请输入节点id"  name="jdSelectType" id="jdSelectType" class="list-input"/>        </div> -->        <div id="two" class="login-input">            <label>&nbsp;&nbsp;节点标题&nbsp;:</label>           <select id="xjdSelectType" style="float:left;line-height:35px;height:35px;width:350px;border:#ebebeb 1px solid;text-indent:5px;">               <option >根据患者情况，请做出选择：</option>               <option>建议进行多科学查访后，做出选择：</option>              </select>        </div>        <div id="three" class="login-input">            <label>&nbsp;&nbsp;节点注释&nbsp;:</label>            <select id="jdSelect" style="float:left;line-height:35px;height:35px;width:350px;border:#ebebeb 1px solid;text-indent:5px;">                <option>commit</option>                <option value="">无注释</option>                          </select>        </div>		<div id="four" class="login-input" style="display:none;">            <label>节点数量:</label>            <input type="text" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" placeholder="请输入节点数量"  name="pnumbe" id="pnumbe" class="list-input"/>        </div>    </div>      <div class="login-button button2"><a href="javascript:void(0);" id="login-button-submit">添加</a></div></div><div class="jdxx"><div class="wrapper" >    <div class="btn-group btn-group-vertical fn-toolbar">        <button class="btn btn-default" id="J_AddNode" type="button"><em class="icon-align-left"></em>添加节点</button>	    <button class="btn btn-default" id="J_PAddNode" type="button"><em class="icon-align-left"></em>批量添加节点</button>        <button class="btn btn-default" id="J_DelNode" type="button"><em class="icon-align-center"></em>删除节点</button>        <button class="btn btn-default" id="J_AddLink" type="button"><em class="icon-align-right"></em>添加连线</button>        <button class="btn btn-default" id="J_DelLink" type="button"><em class="icon-align-justify"></em>删除连线</button>        <button class="btn btn-default" id="J_ExportExcel" type="button"><em class="icon-align-justify"></em>导出Excel</button>		 <input type="file" onchange="sendfile(this)" />         <button class="btn btn-default" id="J_CircleLayout" type="button"><em class="icon-align-justify"></em>圆形布局</button>        <button class="btn btn-default" id="J_RectLayout" type="button"><em class="icon-align-justify"></em>矩形布局</button>        <!-- <button class="btn btn-default" id="J_BackLayout" type="button"><em class="icon-align-justify"></em>还原布局</button>  -->	   <button class="btn btn-default" id="J_stoporigin" type="button"><em class="icon-align-justify"></em>停止模拟力</button>        <button class="btn btn-default" id="J_resumerigin" type="button"><em class="icon-align-justify"></em>重启模拟力</button>		<!-- <button class="btn btn-default" id="J_tuodong" type="button"><em class="icon-align-justify"></em>拖动元素</button>  -->         <button class="btn btn-default" id="J_clecckrigin" type="button"><em class="icon-align-justify"></em>取消所有选中节点</button>          <button class="btn btn-default" id="J_pliangrigin" type="button"><em class="icon-align-justify"></em>为选中节点批量添加下级节点</button> </div>     <div class="graph-area">    </div></div><script type="text/javascript" src="./js/home.bundle.js?33f345029b4f1447cbd9"></script></body></div></div></body>       <script>           var zzexcel;            function sendfile(obj) {                if(!obj.files) {                    return;                }                var f = obj.files[0];                var reader = new FileReader();                reader.readAsBinaryString(f);                reader.onload = function(e) {                    var data = e.target.result;                        zzexcel = XLSX.read(data, {                            type: 'binary'                        });                    for(var i=0;i<zzexcel.SheetNames.length;i++){            　　　		//console.log(zzexcel.Sheets[zzexcel.SheetNames[i]]);						//alert(zzexcel.SheetNames[i]);　　					//	alert(JSON.stringify(XLSX.utils.sheet_to_json(zzexcel.Sheets[zzexcel.SheetNames[i]])));　　				//	console.log(JSON.stringify(XLSX.utils.sheet_to_json(zzexcel.Sheets[zzexcel.SheetNames[i]])));　					var jsonData =JSON.stringify(XLSX.utils.sheet_to_json(zzexcel.Sheets[zzexcel.SheetNames[i]]));						jsonData = jsonData.replace(/nodeId/g,"id");						var  jsonData_1 = jsonData.replace(/nodeName/g,"group");						var  jsonData_2 = jsonData_1.replace(/parentNodeId/g,"source");						jsonData_2 = jsonData_2.replace(/id/g,"target");					jsonData_2 = '['+jsonData_2.substring(jsonData_2.indexOf('}')+2);					jsonData = $.parseJSON( jsonData_1 );					//jsonData_2 = $.parseJSON( jsonData_2 );					//这种方法不对				//	for(var i = 0; i < jsonData.length; i++){				//	 var k=0;				//	 for(var j = 0; j < jsonData.length; j++){				//	 if(jsonData[i].id==jsonData[j].id){				//	     if(k!=0){				//		   jsonData.splice(j,1);  				//		   }				//		    k++;					       //delete jsonData[j].id;									//	 }				//	 }				//	}					       //用这种					       var arr = [];                           for (var i = 0; i < jsonData.length; i++) {                                if (i == 0) arr.push(jsonData[i]);                                b = false;                                if (arr.length > 0 && i > 0) {                                  for (var j = 0; j < arr.length; j++) {                                    if (arr[j].id == jsonData[i].id) {                                      b = true;                                     //break;                                    }                                  }                                  if (!b) {                                    arr.push(jsonData[i]);                                  }                                }                              }	                    jsonData = JSON.stringify(arr);					    var mockData = 					'{"result":{"nodes":'+jsonData+',"links":'+jsonData_2+'}}'			         sessionStorage.setItem("token", mockData);					}                }            }       </script></html>